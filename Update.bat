@echo off
mklink /j guirequired .\config\fancymenu\assets
echo 欢迎使用MineOptimiz Updater
echo 1.下载并更新稳定版
echo 2.下载并更新测试版
echo 3.退出
set /p update=
if "%update%"=="3" exit
echo 请确保Minecraft处于关闭状态
echo 正在下载更新包
if "%update%"=="1" .\guirequired\Update\aria2\aria2c.exe -o Update.zip %stabledownloadlink%
rem 此处%stabledownloadlink%填写一个可自动更新的稳定版整合包下载链接
if "%update%"=="2" .\guirequired\Update\aria2\aria2c.exe -o Update.zip %devdownloadlink%
rem 此处%devdownloadlink%填写一个可自动更新的测试版整合包下载链接
if errorlevel 1 (
  echo 下载失败！
  pause
  exit /b 1
)
echo 下载完成
echo 正在解压更新包
.\guirequired\Update\7z\7z.exe x Update.zip
del Update.zip
ren *.mrpack Update.zip
.\guirequired\Update\7z\7z.exe x Update.zip -o".\Update"
if errorlevel 1 (
  echo 解压失败！
  pause
  exit /b 1
)
echo 解压完成
echo 正在删除旧的文件
rd /s /q config
rd /s /q CustomSkinLoader
rd /s /q mods
rd /s /q resourcepacks
if errorlevel 1 (
  echo 删除失败！
  pause
  exit /b 1
)
echo 删除完成
echo 正在复制新的文件
xcopy .\Update\overrides\config .\config /E /H /I
xcopy .\Update\overrides\CustomSkinLoader .\CustomSkinLoader /E /H /I
xcopy .\Update\overrides\mods .\mods /E /H /I
xcopy .\Update\overrides\resourcepacks .\resourcepacks /E /H /I
if errorlevel 1 (
  echo 复制失败！
  pause
  exit /b 1
)
echo 复制完成！
echo 正在下载非内置组件
.\guirequired\Update\aria2\aria2c.exe -o .\mods\exordium-fabric-1.0.3-mc1.20.jar https://mirror.ghproxy.com/https://github.com/ImGRUI/Exordium/releases/download/1.0.3-1.20/exordium-fabric-1.0.3-mc1.20.jar
.\guirequired\Update\aria2\aria2c.exe -o .\mods\skinlayers3d-fabric-1.6.2-mc1.20.1.jar https://mirror.ghproxy.com/https://github.com/tr7zw/3d-Skin-Layers/releases/download/1.6.2/skinlayers3d-fabric-1.6.2-mc1.20.1.jar
.\guirequired\Update\aria2\aria2c.exe -o .\mods\fancymenu_fabric_3.1.2_MC_1.20.1.jar https://cdn.modrinth.com/data/Wq5SjeWM/versions/r2jmO7md/fancymenu_fabric_3.1.2_MC_1.20.1.jar
.\guirequired\Update\aria2\aria2c.exe -o .\mods\entityculling-fabric-1.6.2-mc1.20.jar https://mirror.ghproxy.com/https://github.com/tr7zw/EntityCulling/releases/download/1.6.2-1.20/entityculling-fabric-1.6.2-mc1.20.jar
.\guirequired\Update\aria2\aria2c.exe -o .\mods\notenoughanimations-fabric-1.7.1-mc1.20.1.jar https://cdn.modrinth.com/data/MPCX6s5C/versions/YbSMjtFY/notenoughanimations-fabric-1.7.1-mc1.20.1.jar
.\guirequired\Update\aria2\aria2c.exe -o .\config\fancymenu\assets\Update\update-dev.sh https://mirror.ghproxy.com/https://github.com/SmallMushroom-offical/MineOptimiz-Updater/releases/download/v1.0.1/update-1.20.1-dev.sh
.\guirequired\Update\aria2\aria2c.exe -o .\config\fancymenu\assets\Update\update-stable.sh https://mirror.ghproxy.com/https://github.com/SmallMushroom-offical/MineOptimiz-Updater/releases/download/v1.0.1/update-1.20.1-stable.sh
.\guirequired\Update\aria2\aria2c.exe -o .\mods\viafabricplus-2.8.7.jar https://cdn.modrinth.com/data/rIC2XJV4/versions/MZzBB2Tu/viafabricplus-2.8.7.jar
.\guirequired\Update\aria2\aria2c.exe -o .\mods\voicechat-fabric-1.20.1-2.5.9.jar https://cdn.modrinth.com/data/9eGKb6K1/versions/blva78z9/voicechat-fabric-1.20.1-2.5.9.jar
if errorlevel 1 (
  echo 下载失败！
  pause
  exit /b 1
)
echo 下载完成
echo 正在删除缓存
rd /s /q guirequired
rd /s /q Update
del Update.zip
if errorlevel 1 (
  echo 删除失败！
  echo 下次更新可能会出问题
)
echo 更新完成！
echo 请重启Minecraft以查看更改
pause
